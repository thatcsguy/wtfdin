<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WTFDIN - What The Fuck Do I Need?</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: #eaeaea;
            --text-secondary: #a0a0a0;
            --accent: #e94560;
            --accent-hover: #ff6b6b;
            --border: #2a2a4a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            color: var(--accent);
        }

        .sidebar-header p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .character-list {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .character-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .character-list-header h2 {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn {
            background-color: var(--accent);
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: var(--accent-hover);
        }

        .btn:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 0.75rem;
        }

        .character-item {
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 4px;
            transition: background-color 0.2s;
        }

        .character-item:hover {
            background-color: var(--bg-tertiary);
        }

        .character-item.selected {
            background-color: var(--bg-tertiary);
            border-left: 3px solid var(--accent);
        }

        .character-item .name {
            font-weight: 500;
        }

        .no-characters {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-align: center;
            padding: 20px;
        }

        /* Main Panel */
        .main-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .main-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .main-header h2 {
            font-size: 1.5rem;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
        }

        .empty-state p {
            margin-bottom: 16px;
        }

        /* Job Pills */
        .job-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .job-pill {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .job-pill:hover {
            background-color: var(--bg-tertiary);
        }

        .job-pill.selected {
            background-color: var(--bg-tertiary);
            border-color: var(--accent);
        }

        .job-pill img {
            width: 24px;
            height: 24px;
        }

        .job-pill span {
            font-size: 0.875rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 24px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            width: 90%;
        }

        .modal h3 {
            margin-bottom: 16px;
            color: var(--accent);
        }

        .job-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 12px;
        }

        .job-grid-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 8px;
            background-color: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .job-grid-item:hover {
            background-color: var(--bg-tertiary);
            border-color: var(--accent);
        }

        .job-grid-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .job-grid-item img {
            width: 40px;
            height: 40px;
            margin-bottom: 6px;
        }

        .job-grid-item span {
            font-size: 0.75rem;
            text-align: center;
        }

        .job-category {
            margin-bottom: 20px;
        }

        .job-category h4 {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .modal-close {
            margin-top: 16px;
            width: 100%;
        }

        .no-jobs {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .job-info {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .job-info h3 {
            margin-bottom: 12px;
            color: var(--accent);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border);
                max-height: 40vh;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>WTFDIN</h1>
                <p>What The Fuck Do I Need?</p>
            </div>
            <div class="character-list">
                <div class="character-list-header">
                    <h2>Characters</h2>
                    <button class="btn btn-small" id="add-character-btn">+ Add</button>
                </div>
                <div id="character-list-container">
                    <p class="no-characters">No characters yet. Add one to get started!</p>
                </div>
            </div>
        </aside>
        <main class="main-panel">
            <div class="main-header">
                <h2 id="character-name">Select a Character</h2>
            </div>
            <div class="main-content">
                <div class="empty-state" id="empty-state">
                    <p>Select a character from the sidebar to view their gear progress.</p>
                </div>
                <div id="character-details" style="display: none;">
                    <!-- Character details will be rendered here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Job Picker Modal -->
    <div class="modal-overlay hidden" id="job-modal">
        <div class="modal">
            <h3>Add Job</h3>
            <div id="job-modal-content"></div>
            <button class="btn modal-close" id="job-modal-close">Cancel</button>
        </div>
    </div>

    <script>
        // WTFDIN - What The Fuck Do I Need?
        // Vanilla JS FFXIV Gear Tracker

        (function() {
            'use strict';

            // FFXIV Job Data with XIVAPI icons
            const JOBS = {
                tanks: [
                    { id: 'PLD', name: 'Paladin', icon: 'https://xivapi.com/cj/1/paladin.png' },
                    { id: 'WAR', name: 'Warrior', icon: 'https://xivapi.com/cj/1/warrior.png' },
                    { id: 'DRK', name: 'Dark Knight', icon: 'https://xivapi.com/cj/1/darkknight.png' },
                    { id: 'GNB', name: 'Gunbreaker', icon: 'https://xivapi.com/cj/1/gunbreaker.png' }
                ],
                healers: [
                    { id: 'WHM', name: 'White Mage', icon: 'https://xivapi.com/cj/1/whitemage.png' },
                    { id: 'SCH', name: 'Scholar', icon: 'https://xivapi.com/cj/1/scholar.png' },
                    { id: 'AST', name: 'Astrologian', icon: 'https://xivapi.com/cj/1/astrologian.png' },
                    { id: 'SGE', name: 'Sage', icon: 'https://xivapi.com/cj/1/sage.png' }
                ],
                melee: [
                    { id: 'MNK', name: 'Monk', icon: 'https://xivapi.com/cj/1/monk.png' },
                    { id: 'DRG', name: 'Dragoon', icon: 'https://xivapi.com/cj/1/dragoon.png' },
                    { id: 'NIN', name: 'Ninja', icon: 'https://xivapi.com/cj/1/ninja.png' },
                    { id: 'SAM', name: 'Samurai', icon: 'https://xivapi.com/cj/1/samurai.png' },
                    { id: 'RPR', name: 'Reaper', icon: 'https://xivapi.com/cj/1/reaper.png' },
                    { id: 'VPR', name: 'Viper', icon: 'https://xivapi.com/cj/1/viper.png' }
                ],
                ranged: [
                    { id: 'BRD', name: 'Bard', icon: 'https://xivapi.com/cj/1/bard.png' },
                    { id: 'MCH', name: 'Machinist', icon: 'https://xivapi.com/cj/1/machinist.png' },
                    { id: 'DNC', name: 'Dancer', icon: 'https://xivapi.com/cj/1/dancer.png' }
                ],
                casters: [
                    { id: 'BLM', name: 'Black Mage', icon: 'https://xivapi.com/cj/1/blackmage.png' },
                    { id: 'SMN', name: 'Summoner', icon: 'https://xivapi.com/cj/1/summoner.png' },
                    { id: 'RDM', name: 'Red Mage', icon: 'https://xivapi.com/cj/1/redmage.png' },
                    { id: 'PCT', name: 'Pictomancer', icon: 'https://xivapi.com/cj/1/pictomancer.png' }
                ]
            };

            const JOB_CATEGORIES = [
                { key: 'tanks', label: 'Tanks' },
                { key: 'healers', label: 'Healers' },
                { key: 'melee', label: 'Melee DPS' },
                { key: 'ranged', label: 'Physical Ranged' },
                { key: 'casters', label: 'Magical Ranged' }
            ];

            // Get flat list of all jobs
            function getAllJobs() {
                return Object.values(JOBS).flat();
            }

            // Get job by ID
            function getJobById(id) {
                return getAllJobs().find(j => j.id === id);
            }

            // State
            let state = {
                characters: [],
                selectedCharacterId: null,
                selectedJobId: null
            };

            // DOM Elements
            const addCharacterBtn = document.getElementById('add-character-btn');
            const characterListContainer = document.getElementById('character-list-container');
            const characterNameHeader = document.getElementById('character-name');
            const emptyState = document.getElementById('empty-state');
            const characterDetails = document.getElementById('character-details');
            const jobModal = document.getElementById('job-modal');
            const jobModalContent = document.getElementById('job-modal-content');
            const jobModalClose = document.getElementById('job-modal-close');

            // Initialize
            function init() {
                loadState();
                render();
                attachEventListeners();
            }

            // Local Storage
            function loadState() {
                const saved = localStorage.getItem('wtfdin-data');
                if (saved) {
                    try {
                        state = JSON.parse(saved);
                    } catch (e) {
                        console.error('Failed to parse saved state:', e);
                    }
                }
            }

            function saveState() {
                localStorage.setItem('wtfdin-data', JSON.stringify(state));
            }

            // Event Listeners
            function attachEventListeners() {
                addCharacterBtn.addEventListener('click', handleAddCharacter);
                jobModalClose.addEventListener('click', closeJobModal);
                jobModal.addEventListener('click', (e) => {
                    if (e.target === jobModal) closeJobModal();
                });
            }

            function handleAddCharacter() {
                const name = prompt('Enter character name:');
                if (name && name.trim()) {
                    const character = {
                        id: Date.now().toString(),
                        name: name.trim(),
                        jobs: []
                    };
                    state.characters.push(character);
                    state.selectedCharacterId = character.id;
                    saveState();
                    render();
                }
            }

            function selectCharacter(id) {
                state.selectedCharacterId = id;
                // Auto-select first job if character has jobs
                const char = state.characters.find(c => c.id === id);
                if (char && char.jobs.length > 0) {
                    state.selectedJobId = char.jobs[0].jobId;
                } else {
                    state.selectedJobId = null;
                }
                saveState();
                render();
            }

            function selectJob(jobId) {
                state.selectedJobId = jobId;
                saveState();
                render();
            }

            // Job Modal
            function openJobModal() {
                const selected = state.characters.find(c => c.id === state.selectedCharacterId);
                if (!selected) return;

                const existingJobIds = selected.jobs.map(j => j.jobId);

                let html = '';
                JOB_CATEGORIES.forEach(cat => {
                    html += `<div class="job-category"><h4>${cat.label}</h4><div class="job-grid">`;
                    JOBS[cat.key].forEach(job => {
                        const isDisabled = existingJobIds.includes(job.id);
                        html += `
                            <div class="job-grid-item ${isDisabled ? 'disabled' : ''}"
                                 data-job-id="${job.id}"
                                 ${isDisabled ? '' : 'tabindex="0"'}>
                                <img src="${job.icon}" alt="${job.name}">
                                <span>${job.name}</span>
                            </div>
                        `;
                    });
                    html += '</div></div>';
                });

                jobModalContent.innerHTML = html;

                // Attach click handlers to job items
                jobModalContent.querySelectorAll('.job-grid-item:not(.disabled)').forEach(item => {
                    item.addEventListener('click', () => addJobToCharacter(item.dataset.jobId));
                    item.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            addJobToCharacter(item.dataset.jobId);
                        }
                    });
                });

                jobModal.classList.remove('hidden');
            }

            function closeJobModal() {
                jobModal.classList.add('hidden');
            }

            function addJobToCharacter(jobId) {
                const selected = state.characters.find(c => c.id === state.selectedCharacterId);
                if (!selected) return;

                // Check if job already exists
                if (selected.jobs.some(j => j.jobId === jobId)) return;

                // Add job with empty gear slots
                selected.jobs.push({
                    jobId: jobId,
                    gear: {}
                });

                // Auto-select the newly added job
                state.selectedJobId = jobId;

                saveState();
                closeJobModal();
                render();
            }

            // Rendering
            function render() {
                renderCharacterList();
                renderMainPanel();
            }

            function renderCharacterList() {
                if (state.characters.length === 0) {
                    characterListContainer.innerHTML = '<p class="no-characters">No characters yet. Add one to get started!</p>';
                    return;
                }

                characterListContainer.innerHTML = state.characters.map(char => `
                    <div class="character-item ${char.id === state.selectedCharacterId ? 'selected' : ''}"
                         data-id="${char.id}">
                        <span class="name">${escapeHtml(char.name)}</span>
                    </div>
                `).join('');

                // Attach click handlers
                characterListContainer.querySelectorAll('.character-item').forEach(item => {
                    item.addEventListener('click', () => selectCharacter(item.dataset.id));
                });
            }

            function renderMainPanel() {
                const selected = state.characters.find(c => c.id === state.selectedCharacterId);

                if (!selected) {
                    characterNameHeader.textContent = 'Select a Character';
                    emptyState.style.display = 'flex';
                    characterDetails.style.display = 'none';
                    return;
                }

                characterNameHeader.textContent = selected.name;
                emptyState.style.display = 'none';
                characterDetails.style.display = 'block';

                // Render jobs
                let jobsHtml = '';
                if (selected.jobs.length > 0) {
                    jobsHtml = '<div class="job-pills">';
                    selected.jobs.forEach(j => {
                        const job = getJobById(j.jobId);
                        if (job) {
                            const isSelected = j.jobId === state.selectedJobId;
                            jobsHtml += `
                                <div class="job-pill ${isSelected ? 'selected' : ''}" data-job-id="${job.id}" tabindex="0">
                                    <img src="${job.icon}" alt="${job.name}">
                                    <span>${job.name}</span>
                                </div>
                            `;
                        }
                    });
                    jobsHtml += '</div>';
                } else {
                    jobsHtml = '<p class="no-jobs">No jobs added yet.</p>';
                }

                // Get selected job info for display
                const selectedJob = state.selectedJobId ? getJobById(state.selectedJobId) : null;
                const jobInfoHtml = selectedJob ? `
                    <div class="job-info">
                        <h3>${selectedJob.name}</h3>
                        <p class="no-jobs">Gear tracking coming soon...</p>
                    </div>
                ` : '';

                characterDetails.innerHTML = `
                    ${jobsHtml}
                    <button class="btn" id="add-job-btn">+ Add Job</button>
                    ${jobInfoHtml}
                `;

                // Attach add job button handler
                document.getElementById('add-job-btn').addEventListener('click', openJobModal);

                // Attach job pill click handlers
                characterDetails.querySelectorAll('.job-pill').forEach(pill => {
                    pill.addEventListener('click', () => selectJob(pill.dataset.jobId));
                    pill.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            selectJob(pill.dataset.jobId);
                        }
                    });
                });
            }

            // Utilities
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Start the app
            init();
        })();
    </script>
</body>
</html>
